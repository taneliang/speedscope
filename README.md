# ðŸ”¬speedscope

Originally, [Speedscope](https://www.speedscope.app/) is a fast, interactive
web-based viewer for performance profiles. For more information, see the
upstream repository https://github.com/jlfwong/speedscope.

This fork exposes some of its internals for use in the [React Concurrent Mode
Profiler](https://react-scheduling-profiler.vercel.app/). There are no plans
to upstream the changes in this fork; for more details, see [this
discussion](https://github.com/jlfwong/speedscope/pull/305#issuecomment-668490063).

# Usage

```sh
yarn add @elg/speedscope
# OR
npm install @elg/speedscope
```

# Maintenance

## Rebasing on upstream

When upstream is updated, we'll want to update this fork as well. Because
this fork adds a few commits on top of Speedscope's `master` branch, we'll
just need to rebase it on `upstream/master` and fix anything that's broken.

1. Update the fork's `master` branch.
1. Rebase `fork-for-scheduling-profiler` on it.
1. Test build: run `yarn build` to run the `scripts/build-release.sh` script.
1. Flow typecheck
   1. `cd dist/library`
   1. Run `flow init` to add a `.flowconfig` file. (assumes you have
      [`flow-bin`](https://www.npmjs.com/package/flow-bin) installed
      globally)
   1. `flow check`. Follow the steps below to fix any errors.
1. Force push to this branch.

## Modifying exports

This package's exports are declared in `src/library.ts`. Exports added here
will be able to be imported.

## Flow types

Flow types are generated by [Flowgen](https://github.com/joarwilk/flowgen)
and manually fixed up with regex. If `flow check` is failing, follow these
steps to fix the errors:

1. Try modifying the TypeScript type definitions to resolve the errors.
1. If that doesn't work, add/modify the regex codemods in
   `scripts/build-release.sh`.

# Deployment

The `fork-for-scheduling-profiler` branch of this repository is automatically
[published to NPM](https://www.npmjs.com/package/@elg/speedscope) by GitHub
Actions.

Our generated version numbers have this format: `<upstream Speedscope version>-<Git commit hash>`
